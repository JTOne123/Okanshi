<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Tutorial
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="In-process monitoring solution"/>
    <meta name="author" content="Telenor MVNO"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/Okanshi/content/style.css" />
    <script type="text/javascript" src="/Okanshi/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/mvno/Okanshi">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/Okanshi/index.html">Okanshi</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Tutorial" class="anchor" href="#Tutorial">Tutorial</a></h1>
<h2><a name="Metrics" class="anchor" href="#Metrics">Metrics</a></h2>
<p>Okanshi has a couple of different monitor types, divided into the following categories:</p>
<ul>
<li>Gauges</li>
<li>Counters</li>
<li>Timers</li>
</ul>
<p>All monitors can be instantiated directly or, declared and used through the static <code>OkanshiMonitor</code> class.</p>
<h3><a name="Gauges" class="anchor" href="#Gauges">Gauges</a></h3>
<p>Gauges are monitors that returns the current value of something. It could be the number of files in a director, the number of users currently logged and etc.</p>
<h4><a name="BasicGauge" class="anchor" href="#BasicGauge">BasicGauge</a></h4>
<p>The <code>BasicGauge</code> is a monitor that takes a <code>Func&lt;T&gt;</code>. Each time the value is polled from the gauge, the <code>Func&lt;T&gt;</code> is called and the value returned is the current value.</p>
<p>Example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.BasicGauge(<span class="s">"Number of users"</span>, () <span class="o">=</span><span class="o">&gt;</span> _numberOfUsers);
<span class="c">// OR</span>
<span class="k">var</span> gauge <span class="o">=</span> <span class="k">new</span> BasicGauge(MonitorConfig.Build(<span class="s">"Number of users"</span>), () <span class="o">=</span><span class="o">&gt;</span> _numberOfUsers);
</code></pre></td></tr></table>
<h4><a name="Max-MinGauge" class="anchor" href="#Max-MinGauge">Max/MinGauge</a></h4>
<p>The <code>MaxGauge</code> is a monitor that tracks the current maximum value. It can be used to track the maximum number of users logged in at the same time or similar. The initial value of the gauge is zero.
The <code>MinGauge</code> is a monitor that tracks the current minimum value. The initial value of the gauge is zero, which means zero is treated as no value at all. This has the affect that if the gauge is zero, and a non zero value is posted to the gauge, it would effectively change the minimum value. This is a bug that will be fixed in a future version.</p>
<p>Example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.MaxGauge(<span class="s">"Maximum number of users"</span>).Set(<span class="n">1</span>); <span class="c">// New maximum is 1</span>
OkanshiMonitor.MaxGauge(<span class="s">"Maximum number of users"</span>).Set(<span class="n">10</span>); <span class="c">// New maximum is 10</span>
OkanshiMonitor.MaxGauge(<span class="s">"Maximum number of users"</span>).Set(<span class="n">0</span>); <span class="c">// Maximum is still 10</span>
<span class="c">// OR</span>
<span class="k">var</span> gauge <span class="o">=</span> <span class="k">new</span> MaxGauge(MonitorConfig.Build(<span class="s">"Maximum number of users"</span>));
gauge.Set(<span class="n">1</span>);
gauge.Set(<span class="n">10</span>);
gauge.Set(<span class="n">0</span>);

OkanshiMonitor.MinGauge(<span class="s">"Minimum number of users"</span>).Set(<span class="n">1</span>); <span class="c">// New minimum is 1</span>
OkanshiMonitor.MinGauge(<span class="s">"Minimum number of users"</span>).Set(<span class="n">10</span>); <span class="c">// Minimum is still 1</span>
OkanshiMonitor.MinGauge(<span class="s">"Minimum number of users"</span>).Set(<span class="n">0</span>); <span class="c">// Minimum is 0</span>
OkanshiMonitor.MinGauge(<span class="s">"Minimum number of users"</span>).Set(<span class="n">1</span>); <span class="c">// Minimum is 1</span>
<span class="c">// OR</span>
<span class="k">var</span> gauge <span class="o">=</span> <span class="k">new</span> MinGauge(MonitorConfig.Build(<span class="s">"Minimum number of users"</span>));
gauge.Set(<span class="n">1</span>);
gauge.Set(<span class="n">10</span>);
gauge.Set(<span class="n">0</span>);
gauge.Set(<span class="n">1</span>);
</code></pre></td></tr></table>
<h4><a name="AverageGauge" class="anchor" href="#AverageGauge">AverageGauge</a></h4>
<p>The <code>AverageGauge</code> monitors the average value over a time interval. This can be for example be used to monitor the average queue length over a time interval.</p>
<p>Example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.AverageGauge(<span class="s">"Average queue length"</span>, TimeSpan.FromMinutes(<span class="n">1</span>)).Set(<span class="n">100</span>); <span class="c">// Average is 100</span>
OkanshiMonitor.AverageGauge(<span class="s">"Average queue length"</span>, TimeSpan.FromMinutes(<span class="n">1</span>)).Set(<span class="n">200</span>); <span class="c">// Average is 150</span>
<span class="c">// OR</span>
<span class="k">var</span> gauge <span class="o">=</span> <span class="k">new</span> AverageGauge(MonitorConfig.Build(<span class="s">"Maximum number of users"</span>), TimeSpan.FromMinutes(<span class="n">1</span>));
gauge.Set(<span class="n">100</span>);
gauge.Set(<span class="n">200</span>);
</code></pre></td></tr></table>
<h4><a name="Long-Double-DecimalGauge" class="anchor" href="#Long-Double-DecimalGauge">Long/Double/DecimalGauge</a></h4>
<p>The <code>LongGauge</code>, <code>DoubleGauge</code> and <code>DecimalGauge</code> are gauges that handles <code>long</code>, <code>double</code> and <code>decimal</code> values respectively. The value you set is the value you get. Usage of these monitors is the same.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.LongGauge(<span class="s">"Maximum number of users"</span>).Set(<span class="n">1</span>); <span class="c">// New value is 1</span>
OkanshiMonitor.LongGauge(<span class="s">"Maximum number of users"</span>).Set(<span class="n">10</span>); <span class="c">// New value is 10</span>
OkanshiMonitor.LongGauge(<span class="s">"Maximum number of users"</span>).Set(<span class="n">0</span>); <span class="c">// New value is 0</span>
<span class="c">// OR</span>
<span class="k">var</span> gauge <span class="o">=</span> <span class="k">new</span> LongGauge(MonitorConfig.Build(<span class="s">"Maximum number of users"</span>));
gauge.Set(<span class="n">1</span>);
gauge.Set(<span class="n">10</span>);
gauge.Set(<span class="n">0</span>);
</code></pre></td></tr></table>
<h3><a name="Counters" class="anchor" href="#Counters">Counters</a></h3>
<p>Counters are monitors that you can increment as needed. They are thread-safe by default.</p>
<h4><a name="Step-DoubleCounter" class="anchor" href="#Step-DoubleCounter">Step/DoubleCounter</a></h4>
<p>A <code>StepCounter</code> is a counter defined by an interval, after each interval the counter is reset. The value of this counter gives you the number of events per second, based on the previous interval. The value of a <code>StepCounter</code> is a long.
A <code>DoubleCounter</code> works the same way as a <code>StepCounter</code>, the only difference is the value, which is a double.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.StepCounter(<span class="s">"Name"</span>, TimeSpan.FromSeconds(<span class="n">1</span>)).Increment();
OkanshiMonitor.StepCounter(<span class="s">"Name"</span>, TimeSpan.FromSeconds(<span class="n">1</span>)).Increment();
Thread.Sleep(<span class="n">2000</span>); <span class="c">// After 2 seconds the value is 1</span>
OkanshiMonitor.StepCounter(<span class="s">"Name"</span>, TimeSpan.FromSeconds(<span class="n">2</span>)).Increment();
Thread.Sleep(<span class="n">2000</span>); <span class="c">// After another 2 seconds the value is 0.5</span>
<span class="c">// OR</span>
<span class="k">var</span> counter <span class="o">=</span> <span class="k">new</span> StepCounter(MonitorConfig.Build(<span class="s">"Name"</span>), TimeSpan.FromSeconds(<span class="n">1</span>));
counter.Increment();
counter.Increment();
Thread.Sleep(<span class="n">2000</span>);
counter.Increment();
Thread.Sleep(<span class="n">2000</span>);
</code></pre></td></tr></table>
<h4><a name="PeakRateCounter" class="anchor" href="#PeakRateCounter">PeakRateCounter</a></h4>
<p>A <code>PeakRateCounter</code> is a counter defined by an interval. After each interval the counter is reset. The value of this counter gives you the number of events possible per second, based on the previous interval.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.PeakRateCounter(<span class="s">"Name"</span>, TimeSpan.FromSeconds(<span class="n">1</span>)).Increment();
OkanshiMonitor.PeakRateCounter(<span class="s">"Name"</span>, TimeSpan.FromSeconds(<span class="n">1</span>)).Increment();
Thread.Sleep(<span class="n">1000</span>); <span class="c">// After 1 second the value is 2</span>
OkanshiMonitor.PeakRateCounter(<span class="s">"Name"</span>, TimeSpan.FromSeconds(<span class="n">1</span>)).Increment();
Thread.Sleep(<span class="n">1000</span>); <span class="c">// After another second the value is 1</span>
<span class="c">// OR</span>
<span class="k">var</span> counter <span class="o">=</span> <span class="k">new</span> PeakRateCounter(MonitorConfig.Build(<span class="s">"Name"</span>), TimeSpan.FromSeconds(<span class="n">1</span>));
counter.Increment();
counter.Increment();
Thread.Sleep(<span class="n">1000</span>);
counter.Increment();
Thread.Sleep(<span class="n">1000</span>);
</code></pre></td></tr></table>
<h4><a name="BasicCounter" class="anchor" href="#BasicCounter">BasicCounter</a></h4>
<p>Is a counter that is never reset. Other than that, it works exactly like all other counters.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.BasicCounter(<span class="s">"Name"</span>).Increment();
OkanshiMonitor.BasicCounter(<span class="s">"Name"</span>).Increment();
Thread.Sleep(<span class="n">1000</span>); <span class="c">// After 1 second the value is 2</span>
OkanshiMonitor.BasicCounter(<span class="s">"Name"</span>).Increment();
Thread.Sleep(<span class="n">1000</span>); <span class="c">// After another second the value is 3</span>
<span class="c">// OR</span>
<span class="k">var</span> counter <span class="o">=</span> <span class="k">new</span> BasicCounter(MonitorConfig.Build(<span class="s">"Name"</span>));
counter.Increment();
counter.Increment();
Thread.Sleep(<span class="n">1000</span>);
counter.Increment();
Thread.Sleep(<span class="n">1000</span>);
</code></pre></td></tr></table>
<h3><a name="Timers" class="anchor" href="#Timers">Timers</a></h3>
<p>Timers measures the time it takes to execute a function.</p>
<p>All timers also support "manual" timing, that are stopped manually instead of passing a Func<T> or Action.
Example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">var</span> timer <span class="o">=</span> OkanshiMonitor.BasicTimer(<span class="s">"Query time"</span>, TimeSpan.FromSeconds(<span class="n">1</span>)).Start()
Thread.Sleep(<span class="n">500</span>);
timer.Stop(); <span class="c">// When stopped the timing is registered</span>
</code></pre></td></tr></table>
<h4><a name="BasicTimer" class="anchor" href="#BasicTimer">BasicTimer</a></h4>
<p>This is a simple timer that, within a specified interval, measures:</p>
<ul>
<li>The execution time of a function,</li>
<li>Tracks the minimum and maximum time of the function call</li>
<li>The number of times the function was called</li>
<li>The total time of the all calls in the specified step</li>
<li>The rate of the calls (the number of calls per second)</li>
</ul>
<p>Example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.BasicTimer(<span class="s">"Query time"</span>, TimeSpan.FromSeconds(<span class="n">1</span>)).Record(() <span class="o">=</span><span class="o">&gt;</span> Thread.Sleep(<span class="n">500</span>)); <span class="c">// Min is 500, Max is 500, Count is 1, TotalTime is 500</span>
OkanshiMonitor.BasicTimer(<span class="s">"Query time"</span>, TimeSpan.FromSeconds(<span class="n">1</span>)).Record(() <span class="o">=</span><span class="o">&gt;</span> Thread.Sleep(<span class="n">100</span>)); <span class="c">// Min is 100, Max is 500, Count is 2, TotalTime is 600</span>
<span class="c">// OR</span>
<span class="k">var</span> timer <span class="o">=</span> <span class="k">new</span> BasicTimer(MonitorConfig.Build(<span class="s">"Query time"</span>, TimeSpan.FromSeconds(<span class="n">1</span>)));
timer.Record(() <span class="o">=</span><span class="o">&gt;</span> Thread.Sleep(<span class="n">500</span>));
timer.Record(() <span class="o">=</span><span class="o">&gt;</span> Thread.Sleep(<span class="n">100</span>))
</code></pre></td></tr></table>
<h4><a name="DurationTimer" class="anchor" href="#DurationTimer">DurationTimer</a></h4>
<p>Prior to version 4, this was called LongTaskTimer.</p>
<p>A monitor for tracking long running operations that might last for many minutes or hours. It is possible to monitor multiple operations running simultanously. It tracks the number of operations currently running, and their current total execution time. The current total execution time is the sum of the current execution time of all the running operations .</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.LongTaskTimer(<span class="s">"Query time"</span>)).Record(() <span class="o">=</span><span class="o">&gt;</span> Thread.Sleep(<span class="n">100000</span>)); <span class="c">// Duration is around 0 and number of active operations is 1</span>
<span class="c">// On another thread</span>
OkanshiMonitor.LongTaskTimer(<span class="s">"Query time"</span>).Record(() <span class="o">=</span><span class="o">&gt;</span> Thread.Sleep(<span class="n">100000</span>)); <span class="c">// Duration is around 0 and number of active operations is 2</span>
Thread.Sleep(<span class="n">5000</span>);
<span class="c">// Duration is known around 5 seconds and number of active tasks is still 2</span>

<span class="c">// OR</span>

<span class="k">var</span> timer <span class="o">=</span> <span class="k">new</span> LongTaskTimer(MonitorConfig.Build(<span class="s">"Query time"</span>));
timer.Record(() <span class="o">=</span><span class="o">&gt;</span> Thread.Sleep(<span class="n">100000</span>));
timer.Record(() <span class="o">=</span><span class="o">&gt;</span> Thread.Sleep(<span class="n">100000</span>));
Thread.Sleep(<span class="n">5000</span>);
</code></pre></td></tr></table>
<h3><a name="Performance-counters" class="anchor" href="#Performance-counters">Performance counters</a></h3>
<p>As of version 4 it is also possible to monitor Windows performance counters.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.PerformanceCounter(PerformanceCounterConfig.Build(<span class="s">"Memory"</span>, <span class="s">"Available Bytes"</span>), <span class="s">"AvailableBytes"</span>);

<span class="c">// OR</span>

<span class="k">var</span> performanceCounterMonitor <span class="o">=</span> <span class="k">new</span> PerformanceCounterMonitor(MonitorConfig.Build(<span class="s">"Available Bytes"</span>), PerformanceCounterConfig.Build(<span class="s">"Memory"</span>, <span class="s">"Available Bytes"</span>));
</code></pre></td></tr></table>
<h2><a name="Health-checks" class="anchor" href="#Health-checks">Health checks</a></h2>
<p>You can also add different health checks to you application. For example the number of files in a directory or something else making sense in you case.
Health checks are added like this:</p>
<p>C#:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">HealthChecks.Add(<span class="s">"key"</span>, () <span class="o">=</span><span class="o">&gt;</span> Directory.GetFiles(<span class="s">"C:\\MyData"</span>).Length <span class="o">=</span><span class="o">=</span> <span class="n">0</span>);
</code></pre></td></tr></table>
<p>F#:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">HealthChecks</span><span class="o">.</span><span class="i">Add</span>(<span class="s">&quot;key&quot;</span>, (<span class="k">fun</span> () <span class="k">-&gt;</span> <span class="i">System</span><span class="o">.</span><span class="i">IO</span><span class="o">.</span><span class="i">Directory</span><span class="o">.</span><span class="i">GetFiles</span>(<span class="s">&quot;C:\\MyData&quot;</span>)<span class="o">.</span><span class="i">Length</span> <span class="o">=</span> <span class="n">0</span>))
</code></pre></td>
</tr>
</table>
<p>The <code>Func</code> passed in just have to return a boolean, indicating pass or fail.</p>
<p>As of version 4 health checks can also be registered as a monitor. This is done like this:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">OkanshiMonitor.HealthCheck(() <span class="o">=</span><span class="o">&gt;</span> Directory.GetFiles(<span class="s">"C:\\MyData"</span>).Length <span class="o">=</span><span class="o">=</span> <span class="n">0</span>, <span class="s">"NoFilesInDirectory"</span>)
</code></pre></td></tr></table>
<h1><a name="HTTP-Endpoint" class="anchor" href="#HTTP-Endpoint">HTTP Endpoint</a></h1>
<p>Prior to version 4, the HTTP endpoint was include in the core package. This is no longer the case, it now exists in a separate package called Okanshi.Endpoint.</p>
<h2><a name="Starting-the-endpoint" class="anchor" href="#Starting-the-endpoint">Starting the endpoint</a></h2>
<p>You start the monitor like this:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">var</span> api <span class="o">=</span> <span class="k">new</span> MonitorApi();
api.Start();
</code></pre></td></tr></table>
<p>You should now be able to access the HTTP endpoint using <a href="http://localhost:13004"><a href="http://localhost:13004">http://localhost:13004</a></a>.
As nothing has been monitored yet, it will return a JSON response with an empty object, like this:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">{}
</code></pre></td>
</tr>
</table>
<p>For custom configuration of the endpoint see the API reference.</p>
<h2><a name="Health-checks-1" class="anchor" href="#Health-checks-1">Health checks</a></h2>
<p>To see the current status of all defined healthchecks, go to <a href="http://localhost:13004/healthchecks"><a href="http://localhost:13004/healthchecks">http://localhost:13004/healthchecks</a></a>.</p>
<h2><a name="Assembly-dependencies" class="anchor" href="#Assembly-dependencies">Assembly dependencies</a></h2>
<p>The endpoint can show all assemblies currently loaded in the AppDomain.</p>
<p>To see all assembly dependencies for you application just access <a href="http://localhost:13004/dependencies"><a href="http://localhost:13004/dependencies">http://localhost:13004/dependencies</a></a>. It will provide a list of the names and version of all dependencies.</p>
<h2><a name="NuGet-dependencies" class="anchor" href="#NuGet-dependencies">NuGet dependencies</a></h2>
<p>If the package.config file is available in the current directory of the process. The endpoint can show all NuGet dependencies and their version. This information can be accessed through <a href="http://localhost:13004/packages"><a href="http://localhost:13004/packages">http://localhost:13004/packages</a></a>.</p>
<h1><a name="Observers" class="anchor" href="#Observers">Observers</a></h1>
<p>Observers are used to store Okanshi metrics, this can be in-memory or by sending it to a database. An observer storing metrics in-memory is included in the Okanshi package.</p>
<p>An observer to send metrics to InfluxDB is provided through another NuGet package called, Okanshi.InfluxDBObserver.</p>
<h2><a name="Observer-setup" class="anchor" href="#Observer-setup">Observer setup</a></h2>
<p>Setting up an observer is easy:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">var</span> observer <span class="o">=</span> <span class="k">new</span> MemoryMetricObserver(<span class="k">new</span> MetricMonitorRegistryPoller(DefaultMonitorRegistry.Instance, options.PollingInterval, options.CollectMetricsOnProcessExit), options.NumberOfSamplesToStore)
</code></pre></td></tr></table>
<p>This observer stores metrics in-memory using a poller getting data from the default monitor registry.</p>
<h1><a name="OWIN" class="anchor" href="#OWIN">OWIN</a></h1>
<p>Using the package Okanshi.Owin it is possible to measure the request duration grouped by path, HTTP method and optionally the response status code.</p>
<p>To enable use the <code>AppBuilder</code> extension method, <code>UseOkanshi</code>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp">app.UseOkanshi()
</code></pre></td></tr></table>
<p>For configuration see the API reference.</p>
<p>Currently the OWIN integration always uses the default registry.</p>


        </div>
        <div class="span3">
          <img src="/Okanshi/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">Okanshi</li>
            <li><a href="/Okanshi/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/Okanshi">Get Library via NuGet</a></li>
            <li><a href="http://github.com/mvno/Okanshi">Source Code on GitHub</a></li>
            <li><a href="/Okanshi/license.html">License</a></li>
            <li><a href="/Okanshi/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/Okanshi/tutorial.html">Sample tutorial</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/Okanshi/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/mvno/Okanshi"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
